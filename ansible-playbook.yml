- hosts: homecloud
  remote_user: debian
  become: yes
  become_method: sudo
  vars_files:
    - vars/main.yml
    - vars/geerlingguy.security.yml
    - vars/geerlingguy.firewall.yml
  roles:
    # - { role: dev-sec.os-hardening }
    - { role: geerlingguy.security }
    - { role: geerlingguy.firewall }
    - { role: nickjj.docker }
    - { role: geerlingguy.ruby }
  tasks:    
  # Install packages
  - name: install htop
    apt:
      name: htop
      update_cache: yes
  - name: install vim
    apt:
      name: vim
      update_cache: yes
  - name: install python-setuptools
    apt:
      name: python-setuptools
      update_cache: yes
  - name: install git
    apt:
      name: git
      update_cache: yes
  - name: install fuse
    apt:
      name: fuse
      update_cache: yes
      
  - name: clone pip repo
    git:
      repo: https://github.com/pypa/pip
      dest: /usr/local/share/pip
  - name: install pip
    command: python setup.py install
    args:
      chdir: /usr/local/share/pip
  - name: install requests
    pip:
      name: requests==2.18.1

  # Mount OVH object storage as volume
  - name: download ovh svfs package
    get_url:
      url: https://github.com/ovh/svfs/releases/download/v0.9.1/svfs-linux-amd64
      dest: /home/debian/svfs-linux-amd64
  # - name: install ovh svfs
    # apt:
      # deb: /home/debian/svfs-linux-amd64


  #Docker
  - name: install docker
    pip:
      name: docker
  - name: install docker-compose
    pip:
      name: docker-compose
    # create docker compose file, upload and run it...
  - name: copy docker-compose file
    copy:
      src: docker-compose.yml
      dest: /home/debian/docker-compose.yml
  - name: docker compose down
    command: docker-compose down
    args:
      chdir: /home/debian
  - name: docker compose up
    command: docker-compose up -d
    args:
      chdir: /home/debian